# MyBatis で監査情報を残すためのサンプル

## 概要

MyBatis で監査情報（タイムスタンプやユーザー情報）の付与や、更新ログテーブルを残すのを半自動化するために作成したサンプル。

Hibernate + Envers のように完全自動で行える環境が最適ではあるけれど、そこまで実装すると大変なことになるので部分的に楽ができる程度の実装です。

## 使用方法

必須のテーブル

* `revinfo`: バージョン情報を保持するモデル。

サンプルで用意しているテーブル。

* `item`
* `item_log`

サンプルで用意している Java クラス。

* `Item`: 監査情報を残したいモデル。
* `ItemLog`: 履歴モデル
* `ItemMapper`: モデルのマッパークラス
* `ItemLogMapper`: 履歴モデルのマッパークラス
* `ItemService`: モデルのサービスクラス
* `ItemLogService`: 履歴モデルのサービスクラス

監査情報を残したいモデルのクラス名 + `Log` が履歴モデル名。

監査情報を残したいモデルと、その履歴モデルは純粋なPOJOである。

監査情報を残したいモデルは `AbstractAuditAware` を継承することで監査情報をモデルに付与できる。また、`@HistoryPersistable`アノテーションの付与で、このモデルが履歴保存可能であることをマークします。

履歴モデルは、元のモデルを継承して、`HistoryAware` を継承する。また、履歴モデル自身の監査情報が更新されないように、`＠NoAudit` アノテーションを付与する。

それぞれのモデル名に `Mapper` を付けたクラスをマッパークラスとして認識。

モデルと、履歴モデルのマッパークラスは `AuditableMapper<E>` を継承している。


